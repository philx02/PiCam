<!DOCTYPE html>
<html>
<head>
<title></title>
<link rel="stylesheet" type="text/css" href="picam.css"/>
</head>
 
<body onload="connect()">

<script src="common.js"></script>

<script>

  var wWebSocket;

  function connect()
  {
  try
  {
  wWebSocket = new WebSocket(QueryString.server);
  }
  catch (exc)
  {
  document.getElementById("debug").innerHTML = exc.message;
  }
  wWebSocket.onopen = function (evt) { greetings(evt); };
  wWebSocket.onmessage = function (evt) { parseMessage(evt); };
  }

  function greetings(evt)
  {
    wWebSocket.send("get_status");
  }

  var wRecordingOverride = false;
  var wLightOverride = false;

  function parseMessage(evt)
  {
    //document.getElementById("debug").innerHTML = evt.data;
    var wSplit = evt.data.split("|");
    if (wSplit[0] == "1")
    {
      document.getElementById("door_switch_status").innerHTML = "ON";
      document.getElementById("door_switch_status").className = "class_on";
    }
    else
    {
      document.getElementById("door_switch_status").innerHTML = "OFF";
      document.getElementById("door_switch_status").className = "class_off";
    }
    if (wSplit[1] == "1")
    {
      document.getElementById("record_status").innerHTML = "ON";
      document.getElementById("record_status").className = "class_on";
    }
    else
    {
      document.getElementById("record_status").innerHTML = "OFF";
      document.getElementById("record_status").className = "class_off";
    }
    if (wSplit[2] == "1")
    {
      document.getElementById("light_status").innerHTML = "ON";
      document.getElementById("light_status").className = "class_on";
    }
    else
    {
      document.getElementById("light_status").innerHTML = "OFF";
      document.getElementById("light_status").className = "class_off";
    }
    wRecordingOverride = wSplit[3] == "1";
    wLightOverride = wSplit[4] == "1";
    if (wRecordingOverride)
    {
      document.getElementById("record_control").innerHTML = "<img class=\"toggle_button\" src=\"ON.png\" />";
    }
    else
    {
      document.getElementById("record_control").innerHTML = "<img class=\"toggle_button\" src=\"OFF.png\" />";
    }
    if (wLightOverride)
    {
      document.getElementById("light_control").innerHTML = "<img class=\"toggle_button\" src=\"ON.png\" />";
    }
    else
    {
      document.getElementById("light_control").innerHTML = "<img class=\"toggle_button\" src=\"OFF.png\" />";
    }
  }

  function recording_override()
  {
    wRecordingOverride = !wRecordingOverride;
    wWebSocket.send("recording_override|" + (wRecordingOverride ? "1" : "0"));
  }

  function light_override()
  {
    wLightOverride = !wLightOverride;
    wWebSocket.send("light_override|" + (wLightOverride ? "1" : "0"));
  }

</script>

<p id="debug"></p>
  <p>
  <table class="status_table">
    <tr>
      <td>Door Switch</td>
      <td id="door_switch_status"></td>
    </tr>
    <tr>
      <td>Recording</td>
      <td id="record_status"></td>
    </tr>
    <tr>
      <td>Light</td>
      <td id="light_status"></td>
    </tr>
  </table>
  </p>

  <p>
    <table class="control_table">
      <tr>
        <td class="override_td">Recording Override</td>
        <td class="toggle_button_td" id="record_control" onclick="recording_override()"></td>
      </tr>
      <tr>
        <td class="override_td">Light Override</td>
        <td class="toggle_button_td" id="light_control" onclick="light_override()"></td>
      </tr>
    </table>
  </p>

</body>
</html> 
